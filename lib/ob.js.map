{"version":3,"sources":["../src/ob.js"],"names":[],"mappings":"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","file":"ob.js","sourcesContent":["import {observe, defineReactive} from './observe.js'\nimport Watcher from './watcher'\nimport Dep from './dep'\nimport {noop} from './util'\n\nob.current = null\nob.deep = true\nObject.setPrototypeOf(ob, {\n  config,\n  method, $method,\n  data, $data,\n  computed, $computed,\n  watch, $watch,\n})\n\nexport default function ob (o, deep = ob.deep) {\n  ob.current = o\n  var isOb = o.hasOwnProperty('_watchers')\n  if (!isOb) {\n    init(o)\n    if (deep) {\n      var value\n      Object.keys(o).forEach(key => {\n        if (typeof o[key] !== 'function') {\n          value = o._data[key] = o[key]\n          ob.$data(value, key, o)\n        }\n      })\n    }\n  }\n  return ob\n}\n\nfunction init (owner) {\n  Object.defineProperty(owner, '_watchers', {\n    value: [],\n    enumerable: false,\n  })\n  Object.defineProperty(owner, '_data', {\n    value: Object.create(null),\n    enumerable: false,\n  })\n  observe(owner._data)\n  return ob\n}\n\nfunction config (config, owner = ob.current || {}) {\n  config.method && $method(config.method, owner)\n  config.prop && $data(config.prop, owner)\n  config.data && $data(config.data, owner)\n  config.computed && $computed(config.computed, owner)\n  return ob\n}\n\nfunction $data (items) {\n  Object.keys(items).forEach(key => data(items[key], key, ob.current))\n  return ob\n}\nfunction data (value, key) {\n  defineReactive(ob.current._data, key, value)\n  proxy(ob.current, key)\n  return ob\n}\n\nfunction $method (items) {\n  Object.keys(items).forEach(key => method(items[key]))\n  return ob\n}\nfunction method (method, key = method.name) {\n  ob.current[key] = method.bind(ob.current)\n  return ob\n}\n\nfunction $computed (items) {\n  Object.keys(items).forEach(key => computed(items[key], key, ob.current))\n  return ob\n}\nfunction computed (computed, key = computed.name) {\n  let desc = {\n    enumerable: true,\n    configurable: true,\n  }\n  if (typeof computed === 'function') {\n    desc.get = makeComputedGetter(computed, ob.current)\n    desc.set = noop\n  } else {\n    desc.get = computed.get ? makeComputedGetter(computed.get, ob.current) : noop\n    desc.set = computed.set ? computed.set.bind(this) : noop\n  }\n  Object.defineProperty(ob.current, key, desc)\n  return ob\n}\n\nfunction $watch (watch) {\n  return ob\n}\nfunction watch (expression, callback) {\n  expression = expression || callback.name\n  /* eslint-disable no-new */\n  new Watcher(\n    ob.current,\n    expression,\n    callback,\n    { deep: true }\n  )\n  /* eslint-enable no-new-func */\n  return ob\n}\n\nfunction proxy (o, key) {\n  Object.defineProperty(o, key, {\n    get: function getter () {\n      return o._data[key]\n    },\n    set: function setter (val) {\n      o._data[key] = val\n    },\n    configurable: true,\n    enumerable: true,\n  })\n}\n\nfunction makeComputedGetter (getter, owner) {\n  var watcher = new Watcher(owner, getter, null, {\n    lazy: true,\n  })\n  return function computedGetter () {\n    if (watcher.dirty) {\n      watcher.evaluate()\n    }\n    if (Dep.target) {\n      watcher.depend()\n    }\n    return watcher.value\n  }\n}\n"]}