{"version":3,"sources":["../src/ob.js"],"names":[],"mappings":"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","file":"ob.js","sourcesContent":["import {\n  observe,\n  defineReactive,\n} from './observe.js'\nimport {\n  watch as watche,\n  makeComputed,\n} from './watcher'\nimport {\n  def,\n  defi,\n  every,\n  noop,\n  isFunc,\n} from './utils'\n\nlet current = null\n\n // {Function} One of carry, react, compute, watch. Default is watch.\nob.default = watch\n\n// {Boolean} Default is true\nreactive.auto = true\n\n// {Boolean} Default is false\nwatch.deep = watch.lazy = watch.sync = false\n\nObject.setPrototypeOf(ob, {\n  reactive,\n  carry, $carry,\n  react, $react,\n  compute, $compute,\n  watch, $watch,\n})\n\n/**\n * ob\n *\n * @param {Object} owner\n * @param {*} [expr]\n * @param {*} [func]\n * @param {*} [opt]\n * @return {Function} ob\n */\n\nexport default function ob (owner, expr, func, opt) {\n  current = owner\n  var isOber = owner.hasOwnProperty('_watchers')\n  if (!isOber) {\n    init(owner)\n    if (reactive.auto) {\n      reactive()\n    }\n  }\n  if (expr) {\n    ob.default(expr, func, opt)\n  }\n  return ob\n}\n\n/**\n * init\n *\n * @param {Object} owner\n * @return {Function} ob\n */\n\nfunction init (owner) {\n  def(owner, '_watchers', [], false)\n  def(owner, '_data', Object.create(null), false)\n  observe(owner._data)\n  return ob\n}\n\n/**\n * reactive\n *\n * @param {Object} config\n * @return {Function} ob\n */\n\nfunction reactive (config) {\n  if (config) {\n    config.methods && $carry(config.methods)\n    config.data && $react(config.data)\n    config.computed && $compute(config.computed)\n    config.watchers && $watch(config.watchers)\n  } else {\n    every(current, function (key, val) {\n      !isFunc(val) && react(key, val)\n    })\n  }\n  return ob\n}\n\n/**\n * carry\n *\n * @param {String} key\n * @param {Function} method\n */\n\nfunction carry (key, method) {\n  current[key] = method.bind(current)\n  return ob\n}\n\n/**\n * $carry\n *\n * @param {Object} items\n * @return {Function} ob\n */\n\nfunction $carry (items) {\n  every(items, function (key, val) {\n    carry(key, val)\n  })\n  return ob\n}\n\n/**\n * react\n *\n * @param {String} key\n * @param {*} val\n */\n\nfunction react (key, val) {\n  current._data[key] = val\n  defineReactive(current._data, key, val)\n  proxy(current, key)\n  return ob\n}\n\n/**\n * $react\n *\n * @param {Object} items\n * @return {Function} ob\n */\n\nfunction $react (items) {\n  every(items, function (key, val) {\n    react(key, val)\n  })\n  return ob\n}\n\n/**\n * compute\n *\n * @param {String} key\n * @param {Function|Object} accessor\n *        - Function getter\n *        - Object\n *          - Function [get]  - getter\n *          - Function [set]  - setter\n * @param {Boolean} [cache]  - default is true\n */\n\nfunction compute (key, accessor, cache) {\n  var getter, setter\n  if (isFunc(accessor)) {\n    getter = makeComputed(current, accessor)\n    setter = noop\n  } else {\n    getter = accessor.get\n            ? cache !== false\n              ? makeComputed(current, accessor.get)\n              : accessor.get.bind(this)\n            : noop\n    setter = accessor.set ? accessor.set.bind(this) : noop\n  }\n  defi(current, key, getter, setter)\n}\n\n/**\n * $compute\n *\n * @param {Object} items\n * @return {Function} ob\n */\n\nfunction $compute (items) {\n  every(items, function (key, val) {\n    compute(key, val)\n  })\n  return ob\n}\n\n/**\n * watch\n *\n * @param {String|Function} exprOrFunc\n * @param {Function} callback\n * @param {Object} [options]\n *                 - {Boolean} deep\n *                 - {Boolean} sync\n *                 - {Boolean} lazy\n */\n\nfunction watch (exprOrFunc, callback, options) {\n  return watche(current, exprOrFunc, callback, options || watch)\n}\n\n/**\n * $watch\n *\n * @param {Object} items\n * @return {Function} ob\n */\n\nfunction $watch (items) {\n  every(items, function (expr, fnOrOpt) {\n    if (isFunc(fnOrOpt)) {\n      watch(expr, fnOrOpt)\n    } else {\n      watch(expr, fnOrOpt.watcher, fnOrOpt)\n    }\n  })\n  return ob\n}\n\n/**\n * proxy\n *\n * @param {Object} owner\n * @param {String} key\n */\n\nfunction proxy (owner, key) {\n  function getter () {\n    return owner._data[key]\n  }\n  function setter (val) {\n    owner._data[key] = val\n  }\n  defi(owner, key, getter, setter)\n}\n"]}